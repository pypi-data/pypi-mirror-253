(self["webpackChunkKalabash"]=self["webpackChunkKalabash"]||[]).push([[106],{8658:function(t,e,s){"use strict";s.d(e,{Z:function(){return f}});var a=s(4324),n=s(5808),i=s(4525),l=s(9378),o=s(4611),r=function(){var t=this,e=t._self._c;return e(n.Z,{attrs:{dense:""}},t._l(t.items,(function(s,n){return e(i.Z,{key:n,on:{click:function(e){return s.onClick(t.object)}}},[e(o.Z,[e(a.Z,{attrs:{color:s.color}},[t._v(t._s(s.icon))])],1),e(l.km,[e(l.V9,[t._v(t._s(s.label))])],1)],1)})),1)},c=[],u={props:["items","object"]},m=u,h=s(1001),d=(0,h.Z)(m,r,c,!1,null,null,null),f=d.exports},6287:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return T}});var a=s(6313),n=s(7953),i=function(){var t=this,e=t._self._c;return e("div",[e(a.Z,{attrs:{flat:""}},[e(n.qW,[e("translate",[t._v("Opened alarms")])],1)],1),e("alarm-list")],1)},l=[],o=s(4562),r=s(4145),c=s(4127),u=s(5151),m=s(4324),h=s(5808),d=s(4528),f=s(3687),p=s(7808),g=function(){var t=this,e=t._self._c;return e(r.Z,{staticClass:"mt-6"},[e(a.Z,{attrs:{flat:""}},[e(d.Z,{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:a}){return[e(o.Z,t._g(t._b({attrs:{small:""}},"v-btn",a,!1),s),[t._v(" Actions "),e(m.Z,{attrs:{right:""}},[t._v("mdi-chevron-down")])],1)]}}])},[e(h.Z,{attrs:{dense:""}},[e("menu-items",{attrs:{items:t.getActionMenuItems()}})],1)],1),e(f.Z),e(p.Z,{attrs:{"prepend-inner-icon":"mdi-magnify",placeholder:"Search",filled:"",outlined:"",dense:"","hide-details":""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),e(u.Z,{staticClass:"elevation-1",attrs:{headers:t.headers,items:t.alarms,search:t.search,"item-key":"id",options:t.options,"server-items-length":t.totalAlarms,loading:t.loading,"footer-props":t.customFooterProps,"show-select":""},on:{"update:options":function(e){t.options=e}},scopedSlots:t._u([{key:"item.status",fn:function({item:s}){return[1===s.status?e(c.Z,{attrs:{color:"warning",small:""}},[e("translate",[t._v("Opened")])],1):e(c.Z,{attrs:{color:"info",small:""}},[e("translate",[t._v("Closed")])],1)]}},{key:"item.mailbox",fn:function({item:e}){return[e.mailbox?[t._v(" "+t._s(e.mailbox.address)+"@"+t._s(e.domain.name)+" ")]:[t._v(" / ")]]}},{key:"item.created",fn:function({item:e}){return[t._v(" "+t._s(t._f("date")(e.created))+" ")]}},{key:"item.actions",fn:function({item:s}){return[e("div",{staticClass:"text-right"},[e(d.Z,{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:a}){return[e(o.Z,t._g(t._b({attrs:{icon:""}},"v-btn",a,!1),s),[e(m.Z,[t._v("mdi-dots-horizontal")])],1)]}}],null,!0)},[e("menu-items",{attrs:{items:t.getMenuItems(s),object:s}})],1)],1)]}}]),model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}})],1)},v=[],x=(s(7658),s(5282)),A=s(3603),_=s(296),Z=s.n(_),b=s(8658),k={u:1,N:2},$={components:{MenuItems:b.Z},data(){return{alarms:[],customFooterProps:{"items-per-page-options":[25,50,100,200]},headers:[{text:this.$gettext("Triggered"),value:"created"},{text:this.$gettext("Status"),value:"status"},{text:this.$gettext("Domain"),value:"domain.name",sortable:!1},{text:this.$gettext("Mailbox"),value:"mailbox",sortable:!1},{text:this.$gettext("Message"),value:"title"},{text:this.$gettext("Actions"),value:"actions",sortable:!1,align:"right"}],loading:!0,options:{},search:"",selected:[],totalAlarms:0}},methods:{fetchAlarms(){const t={page:this.options.page,page_size:this.options.itemsPerPage};this.options.sortBy&&(t.ordering=this.options.sortBy.map((t=>this.options.sortDesc[0]?`-${t}`:t)).join(",")),""!==this.search&&(t.search=this.search),this.loading=!0,A.Z.getAll(t).then((t=>{this.alarms=t.data.results,this.totalAlarms=t.data.count,this.loading=!1}))},async deleteAlarm(t,e=!0){A.Z["delete"](t.id).then((()=>{e&&(x.$.$emit("notification",{msg:this.$gettext("Alarm deleted")}),this.fetchAlarms())}))},async closeAlarm(t){A.Z.switchStatus(t.id,{status:k.N}).then((()=>{x.$.$emit("notification",{msg:this.$gettext("Alarm closed")}),this.fetchAlarms()}))},async openAlarm(t){A.Z.switchStatus(t.id,{status:k.u}).then((()=>{x.$.$emit("notification",{msg:this.$gettext("Alarm re-opened")}),this.fetchAlarms()}))},async deleteAlarms(){await A.Z.bulkDelete(this.selected.map((t=>t.id))),x.$.$emit("notification",{msg:this.$gettext("Alarms deleted")}),this.selected=[],this.fetchAlarms()},getMenuItems(t){const e=[];return e.push({label:this.$gettext("Delete"),icon:"mdi-delete-outline",onClick:this.deleteAlarm,color:"red"}),t.status===k.u?e.push({label:this.$gettext("Close alarm"),icon:"mdi-check",onClick:this.closeAlarm,color:"green"}):e.push({label:this.$gettext("Reopen alarm"),icon:"mdi-alert-circle-outline",onClick:this.openAlarm,color:"orange"}),e},getActionMenuItems(){const t=[];return this.selected.length>0&&t.push({label:this.$gettext("Delete"),icon:"mdi-delete-outline",onClick:this.deleteAlarms,color:"red"}),t.push({label:this.$gettext("Reload"),icon:"mdi-reload",onClick:this.fetchAlarms}),t}},mounted(){this.fetchAlarms()},created(){this.fetchAlarms=Z()(this.fetchAlarms,500)},watch:{options:{handler(){this.fetchAlarms()},deep:!0},search(){this.fetchAlarms()}}},y=$,C=s(1001),w=(0,C.Z)(y,g,v,!1,null,null,null),M=w.exports,D={components:{AlarmList:M}},S=D,I=(0,C.Z)(S,i,l,!1,null,"06761a60",null),T=I.exports},296:function(t){function e(t,e,s){var a,n,i,l,o;function r(){var c=Date.now()-l;c<e&&c>=0?a=setTimeout(r,e-c):(a=null,s||(o=t.apply(i,n),i=n=null))}null==e&&(e=100);var c=function(){i=this,n=arguments,l=Date.now();var c=s&&!a;return a||(a=setTimeout(r,e)),c&&(o=t.apply(i,n),i=n=null),o};return c.clear=function(){a&&(clearTimeout(a),a=null)},c.flush=function(){a&&(o=t.apply(i,n),i=n=null,clearTimeout(a),a=null)},c}e.debounce=e,t.exports=e},3687:function(t,e,s){"use strict";s(9027);var a=s(5352);e["Z"]=(0,a.Ji)("spacer","div","v-spacer")}}]);
//# sourceMappingURL=106.58cdedba.js.map