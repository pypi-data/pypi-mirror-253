"use strict";(self["webpackChunkKalabash"]=self["webpackChunkKalabash"]||[]).push([[761],{322:function(t,e,i){i.d(e,{Z:function(){return b}});var s=i(344),a=i(4562),o=i(4145),n=i(4886),r=i(5151),l=i(4324),d=i(3687),m=function(){var t=this,e=t._self._c;return e(o.Z,[e(n.EB,[e("span",{staticClass:"headline"},[t.dialogMode?e("translate",{staticClass:"headline"},[t._v("Administrators of "+t._s(t.domain.name))]):e("translate",{staticClass:"headline"},[t._v("Administrators")])],1)]),e(n.ZB,[e(r.Z,{attrs:{headers:t.headers,items:t.administrators,"hide-default-footer":""},scopedSlots:t._u([{key:"item.username",fn:function({item:i}){return[i.id?e("span",[t._v(t._s(i.username))]):e(s.Z,{attrs:{label:t._f("translate")("Select an account"),items:t.accounts,"item-text":"username","return-object":""},scopedSlots:t._u([{key:"append-outer",fn:function(){return[t.selectedAccount?e(a.Z,{attrs:{icon:"",color:"primary"},on:{click:t.addAdministrator}},[e(l.Z,[t._v("mdi-content-save")])],1):t._e()]},proxy:!0}],null,!0),model:{value:t.selectedAccount,callback:function(e){t.selectedAccount=e},expression:"selectedAccount"}})]}},{key:"item.name",fn:function({item:e}){return[t._v(" "+t._s(e.first_name)+" "+t._s(e.last_name)+" ")]}},{key:"item.actions",fn:function({item:i}){return[i.id?e(a.Z,{attrs:{icon:"",color:"red",title:t._f("translate")("Remove this administrator")},on:{click:function(e){return t.removeAdministrator(i)}}},[e(l.Z,[t._v("mdi-delete-outline")])],1):t._e()]}}])}),t.hideAddBtn?t._e():e(a.Z,{attrs:{small:"",color:"primary",outlined:""},on:{click:t.addRow}},[e(l.Z,{attrs:{small:""}},[t._v("mdi-plus")]),t._v(" "),e("translate",[t._v("Add administrator")])],1)],1),t.dialogMode?e(n.h7,[e(d.Z),e(a.Z,{attrs:{color:"grey darken-1",text:""},on:{click:t.close}},[e("translate",[t._v("Close")])],1)],1):t._e()],1)},c=[],h=(i(7658),i(9066)),u=i(7913),p=i(5282),f={props:{domain:Object,dialogMode:{type:Boolean,default:!1}},data(){return{accounts:[],administrators:[],headers:[{text:this.$gettext("Username"),value:"username"},{text:this.$gettext("Name"),value:"name"},{text:"",value:"actions",align:"right",sortable:!1}],hideAddBtn:!1,selectedAccount:null}},methods:{addRow(){this.administrators.push({}),this.hideAddBtn=!0},close(){this.$emit("close"),this.hideAddBtn=!1},fetchAdministrators(t){u.Z.getDomainAdministrators(t.pk).then((t=>{this.administrators=t.data}))},fetchAccounts(){h.Z.getAll({role:"DomainAdmins"}).then((t=>{this.accounts=t.data.filter((t=>void 0===this.administrators.find((e=>e.id===t.pk))))}))},addAdministrator(){u.Z.addDomainAdministrator(this.domain.pk,this.selectedAccount.pk).then((t=>{this.fetchAdministrators(this.domain),this.accounts=this.accounts.filter((t=>t.pk!==this.selectedAccount.pk)),this.selectedAccount=null,this.hideAddBtn=!1,p.$.$emit("notification",{msg:this.$gettext("Administrator added")})}))},removeAdministrator(t){u.Z.removeDomainAdministrator(this.domain.pk,t.id).then((t=>{this.fetchAdministrators(this.domain),this.fetchAccounts(),p.$.$emit("notification",{msg:this.$gettext("Administrator removed")})}))}},watch:{domain:{handler:function(t){this.fetchAdministrators(t),this.fetchAccounts()},immediate:!0}}},g=f,_=i(1001),v=(0,_.Z)(g,m,c,!1,null,null,null),b=v.exports},337:function(t,e,i){i.d(e,{Z:function(){return y}});var s=i(3694),a=i(4562),o=i(4145),n=i(4886),r=(i(7658),i(7808)),l=r.Z,d=i(4127),m=i(5352),c=i(4101),h=i(1767),u=l.extend({name:"v-file-input",model:{prop:"value",event:"change"},props:{chips:Boolean,clearable:{type:Boolean,default:!0},counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,placeholder:String,prependIcon:{type:String,default:"$file"},readonly:{type:Boolean,default:!1},showSize:{type:[Boolean,Number],default:!1,validator:t=>"boolean"===typeof t||[1e3,1024].includes(t)},smallChips:Boolean,truncateLength:{type:[Number,String],default:22},type:{type:String,default:"file"},value:{default:void 0,validator:t=>(0,m.TI)(t).every((t=>null!=t&&"object"===typeof t))}},computed:{classes(){return{...l.options.computed.classes.call(this),"v-file-input":!0}},computedCounterValue(){const t=this.multiple&&this.lazyValue?this.lazyValue.length:this.lazyValue instanceof File?1:0;if(!this.showSize)return this.$vuetify.lang.t(this.counterString,t);const e=this.internalArrayValue.reduce(((t,{size:e=0})=>t+e),0);return this.$vuetify.lang.t(this.counterSizeString,t,(0,m.XE)(e,1024===this.base))},internalArrayValue(){return(0,m.TI)(this.internalValue)},internalValue:{get(){return this.lazyValue},set(t){this.lazyValue=t,this.$emit("change",this.lazyValue)}},isDirty(){return this.internalArrayValue.length>0},isLabelActive(){return this.isDirty},text(){return this.isDirty||!this.persistentPlaceholder&&!this.isFocused&&this.hasLabel?this.internalArrayValue.map((t=>{const{name:e="",size:i=0}=t,s=this.truncateText(e);return this.showSize?`${s} (${(0,m.XE)(i,1024===this.base)})`:s})):[this.placeholder]},base(){return"boolean"!==typeof this.showSize?this.showSize:void 0},hasChips(){return this.chips||this.smallChips}},watch:{readonly:{handler(t){!0===t&&(0,c.N6)("readonly is not supported on <v-file-input>",this)},immediate:!0},value(t){const e=this.multiple?t:t?[t]:[];(0,m.vZ)(e,this.$refs.input.files)||(this.$refs.input.value="")}},methods:{clearableCallback(){this.internalValue=this.multiple?[]:null,this.$refs.input.value=""},genChips(){return this.isDirty?this.text.map(((t,e)=>this.$createElement(d.Z,{props:{small:this.smallChips},on:{"click:close":()=>{const t=this.internalValue;t.splice(e,1),this.internalValue=t}}},[t]))):[]},genControl(){const t=l.options.methods.genControl.call(this);return this.hideInput&&(t.data.style=(0,h.y0)(t.data.style,{display:"none"})),t},genInput(){const t=l.options.methods.genInput.call(this);return t.data.attrs.multiple=this.multiple,delete t.data.domProps.value,delete t.data.on.input,t.data.on.change=this.onInput,[this.genSelections(),t]},genPrependSlot(){if(!this.prependIcon)return null;const t=this.genIcon("prepend",(()=>{this.$refs.input.click()}));return this.genSlot("prepend","outer",[t])},genSelectionText(){const t=this.text.length;return t<2?this.text:this.showSize&&!this.counter?[this.computedCounterValue]:[this.$vuetify.lang.t(this.counterString,t)]},genSelections(){const t=[];return this.isDirty&&this.$scopedSlots.selection?this.internalArrayValue.forEach(((e,i)=>{this.$scopedSlots.selection&&t.push(this.$scopedSlots.selection({text:this.text[i],file:e,index:i}))})):t.push(this.hasChips&&this.isDirty?this.genChips():this.genSelectionText()),this.$createElement("div",{staticClass:"v-file-input__text",class:{"v-file-input__text--placeholder":this.placeholder&&!this.isDirty,"v-file-input__text--chips":this.hasChips&&!this.$scopedSlots.selection}},t)},genTextFieldSlot(){const t=l.options.methods.genTextFieldSlot.call(this);return t.data.on={...t.data.on||{},click:()=>this.$refs.input.click()},t},onInput(t){const e=[...t.target.files||[]];this.internalValue=this.multiple?e:e[0],this.initialValue=this.internalValue},onKeyDown(t){this.$emit("keydown",t)},truncateText(t){if(t.length<Number(this.truncateLength))return t;const e=Math.floor((Number(this.truncateLength)-1)/2);return`${t.slice(0,e)}â€¦${t.slice(t.length-e)}`}}}),p=i(3687),f=i(9884),g=function(){var t=this,e=t._self._c;return e(o.Z,[e(n.EB,[e("span",{staticClass:"headline"},[t._v(t._s(t.title))])]),e(n.ZB,[e(s.Z,{attrs:{text:"",type:"info"}},[e("translate",{attrs:{tag:"p"}},[t._v("Provide a CSV file where lines respect one of the following formats:")]),t._t("help"),e("translate",{attrs:{tag:"p"}},[t._v("The first element of each line is mandatory and must be equal to one of the previous values.")]),e("translate",{attrs:{tag:"p"}},[t._v("You can use a different character as separator.")])],2),e("validation-observer",{ref:"observer"},[e("validation-provider",{attrs:{name:"name",rules:"required"},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("label",{staticClass:"m-label"},[e("translate",[t._v("Select file")])],1),e(u,{attrs:{accept:"text/csv","error-messages":i,"truncate-length":"15",outlined:"",dense:""},model:{value:t.form.sourcefile,callback:function(e){t.$set(t.form,"sourcefile",e)},expression:"form.sourcefile"}})]}}])}),e("validation-provider",{attrs:{name:"name",rules:"required"},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("label",{staticClass:"m-label"},[e("translate",[t._v("Separator")])],1),e(r.Z,{attrs:{"error-messages":i,outlined:"",dense:""},model:{value:t.form.sepchar,callback:function(e){t.$set(t.form,"sepchar",e)},expression:"form.sepchar"}})]}}])}),e(f.Z,{attrs:{label:t._f("translate")("Continue on error"),color:"primary",dense:"",hint:t._f("translate")("Don't treat duplicated objects as errors"),"persistent-hint":""},model:{value:t.form.continue_if_exists,callback:function(e){t.$set(t.form,"continue_if_exists",e)},expression:"form.continue_if_exists"}}),t._t("extraFields",null,{form:t.form})],2)],1),e(n.h7,[e(p.Z),e(a.Z,{on:{click:t.close}},[e("translate",[t._v("Close")])],1),e(a.Z,{attrs:{color:"primary"},on:{click:t.submit}},[e("translate",[t._v("Import")])],1)],1)],1)},_=[],v={props:{helpText:String,title:String},data(){return{form:{}}},methods:{close(){this.form={},this.$refs.observer.reset(),this.$emit("close")},async submit(){const t=await this.$refs.observer.validate();if(!t)return;const e=new FormData;e.append("sourcefile",this.form.sourcefile),this.form.sepchar&&e.append("sepchar",this.form.sepchar),this.form.continue_if_exists&&e.append("continue_if_exists",this.form.continue_if_exists),this.$emit("beforeSubmit",e),this.$emit("submit",e)}}},b=v,$=i(1001),x=(0,$.Z)(b,g,_,!1,null,null,null),y=x.exports},2573:function(t,e,i){i.r(e),i.d(e,{default:function(){return Ct}});var s=i(4562),a=i(4061),o=i(4324),n=i(5808),r=i(4525),l=i(9378),d=i(4528),m=i(3687),c=i(6313),h=i(7953),u=function(){var t=this,e=t._self._c;return e("div",[e(c.Z,{attrs:{flat:""}},[e(h.qW,[e("translate",[t._v("Domains")])],1),e(m.Z),e(s.Z,{staticClass:"mr-2",attrs:{title:t._f("translate")("Import domains and aliases from CSV file")},on:{click:function(e){t.showImportForm=!0}}},[e(o.Z,[t._v("mdi-file-import-outline")])],1),e(s.Z,{staticClass:"mr-2",attrs:{title:t._f("translate")("Export domains and aliases to CSV")},on:{click:t.exportDomains}},[e(o.Z,[t._v("mdi-file-export-outline")])],1),e(d.Z,{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function({on:i,attrs:a}){return[e(s.Z,t._g(t._b({attrs:{color:"primary"}},"v-btn",a,!1),i),[e(o.Z,{attrs:{left:""}},[t._v("mdi-plus")]),e("translate",[t._v("New")])],1)]}}])},[e(n.Z,{attrs:{dense:""}},[e(r.Z,{on:{click:function(e){t.showDomainWizard=!0}}},[e(l.V9,[e("translate",[t._v("Domain")])],1)],1),e(r.Z,{on:{click:function(e){t.showAliasForm=!0}}},[e(l.V9,[e("translate",[t._v("Alias")])],1)],1)],1)],1)],1),e("domain-list"),e(a.Z,{attrs:{fullscreen:"",scrollable:"",transition:"dialog-bottom-transition"},model:{value:t.showDomainWizard,callback:function(e){t.showDomainWizard=e},expression:"showDomainWizard"}},[e("domain-creation-form",{on:{close:function(e){t.showDomainWizard=!1}}})],1),e(a.Z,{attrs:{persistent:"","max-width":"800px"},model:{value:t.showAliasForm,callback:function(e){t.showAliasForm=e},expression:"showAliasForm"}},[e("domain-alias-form",{on:{close:function(e){t.showAliasForm=!1}}})],1),e(a.Z,{attrs:{persistent:"","max-width":"800px"},model:{value:t.showImportForm,callback:function(e){t.showImportForm=e},expression:"showImportForm"}},[e("import-form",{ref:"importForm",attrs:{title:t._f("translate")("Import domains")},on:{submit:t.importDomains,close:function(e){t.showImportForm=!1}},scopedSlots:t._u([{key:"help",fn:function(){return[e("ul",[e("li",[e("em",[t._v("domain; name; quota; default mailbox quota; enabled")])]),e("li",[e("em",[t._v("domainalias; name; targeted domain; enabled")])]),e("li",[e("em",[t._v("relaydomain; name; target host; target port; service; enabled; verify recipients")])])])]},proxy:!0}])})],1)],1)},p=[],f=i(7913),g=i(4145),_=i(4886),v=i(9559),b=i(9884),$=i(7808),x=function(){var t=this,e=t._self._c;return e(g.Z,[e(_.EB,[e("span",{staticClass:"headline"},[t._v(t._s(t.title))])]),e(_.ZB,[e("validation-observer",{ref:"observer"},[e("validation-provider",{attrs:{name:"name",rules:"required"},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("label",{staticClass:"m-label"},[t._v(t._s(t.$gettext("Name")))]),e($.Z,{attrs:{dense:"",outlined:"","error-messages":i},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})]}}])}),e("validation-provider",{attrs:{name:"target",rules:"required"},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("label",{staticClass:"m-label"},[t._v(t._s(t.$gettext("Choose a domain")))]),e(v.Z,{attrs:{items:t.domains,"item-text":"name","item-value":"pk","error-messages":i,"single-line":"",dense:"",outlined:""},model:{value:t.form.target,callback:function(e){t.$set(t.form,"target",e)},expression:"form.target"}})]}}])}),e(b.Z,{attrs:{label:"Enabled",color:"primary"},model:{value:t.form.enabled,callback:function(e){t.$set(t.form,"enabled",e)},expression:"form.enabled"}})],1)],1),e(_.h7,[e(m.Z),e(s.Z,{on:{click:t.close}},[e("translate",[t._v("Close")])],1),t.domainAlias&&t.domainAlias.pk?e(s.Z,{attrs:{color:"error"},on:{click:t.deleteAlias}},[e("translate",[t._v("Delete")])],1):t._e(),e(s.Z,{attrs:{color:"primary"},on:{click:t.submit}},[t._v(" "+t._s(t.submitLabel)+" ")])],1)],1)},y=[],k=i(629),Z=i(5282),A={props:{domainAlias:{type:Object,default:()=>null}},computed:{...(0,k.Se)({domains:"domains/domains"}),submitLabel(){return this.domainAlias?this.$gettext("Update"):this.$gettext("Add")},title(){return this.domainAlias?this.$gettext("Edit domain alias"):this.$gettext("Add a new domain alias")}},data(){return{form:{enabled:!0}}},methods:{close(){this.$emit("close"),this.form={enabled:!0}},deleteAlias(){f.Z.deleteDomainAlias(this.domainAlias.pk).then((t=>{this.$emit("alias-deleted"),Z.$.$emit("notification",{msg:this.$gettext("Domain alias deleted")})}))},async submit(){const t=await this.$refs.observer.validate();if(t)try{if(this.form.pk){const t=JSON.parse(JSON.stringify(this.form));t.target=t.target.pk,await f.Z.updateDomainAlias(this.form.pk,t).then((t=>{Z.$.$emit("notification",{msg:this.$gettext("Domain alias updated")}),this.close()}))}else await f.Z.createDomainAlias(this.form).then((t=>{Z.$.$emit("notification",{msg:this.$gettext("Domain alias created")}),this.$emit("alias-created",t.data),this.close()}))}catch(e){this.$refs.observer.setErrors(e.response.data)}}},mounted(){this.domainAlias&&(this.form=JSON.parse(JSON.stringify(this.domainAlias)))},watch:{domainAlias(t){t&&(this.form=JSON.parse(JSON.stringify(t)))}}},w=A,D=i(1001),C=(0,D.Z)(w,x,y,!1,null,null,null),S=C.exports,B=i(266),F=i(1713),I=function(){var t=this,e=t._self._c;return e("creation-form",{ref:"form",attrs:{title:t._f("translate")("New domain"),steps:t.steps,"form-getter":t.getForm,"form-observer-getter":t.getObserver,"validate-object":t.validateDomain,"summary-sections":t.summarySections},on:{close:t.close,create:t.submit},scopedSlots:t._u([{key:"form.general",fn:function({step:i}){return[e("domain-general-form",{ref:`form_${i}`,model:{value:t.domain,callback:function(e){t.domain=e},expression:"domain"}})]}},{key:"form.dns",fn:function({step:i}){return[e("domain-dns-form",{ref:`form_${i}`,model:{value:t.domain,callback:function(e){t.domain=e},expression:"domain"}})]}},{key:"form.limitations",fn:function({step:i}){return[e("domain-limitations-form",{ref:`form_${i}`,model:{value:t.domain,callback:function(e){t.domain=e},expression:"domain"}})]}},{key:"form.options",fn:function({step:i}){return[e("domain-options-form",{ref:`form_${i}`,on:{createAdmin:t.updateCreateAdmin},model:{value:t.domain,callback:function(e){t.domain=e},expression:"domain"}})]}},{key:"form.transport",fn:function({step:i}){return[e("domain-transport-form",{ref:`form_${i}`,model:{value:t.domain.transport,callback:function(e){t.$set(t.domain,"transport",e)},expression:"domain.transport"}})]}},{key:"item.with_random_password",fn:function({item:i}){return[i.value?[e(B.Z,{staticClass:"highligth white--text",attrs:{cols:"12"}},[e(F.Z,[e(B.Z,[e("span",[t._v(t._s(i.key))])]),e(B.Z,{staticClass:"text-right"},[t._v(t._s(t._f("yesno")(i.value)))])],1),e(F.Z,[e(B.Z,{staticClass:"text-right py-1"},[t._v(" "+t._s(t.domain.domain_admin.password)+" "),e(s.Z,{attrs:{icon:"",color:"white",title:t._f("translate")("Copy to clipboard")},on:{click:t.copyPassword}},[e(o.Z,[t._v("mdi-clipboard-multiple-outline")])],1)],1)],1)],1)]:[e(B.Z,[e("span",{staticClass:"grey--text"},[t._v(t._s(i.key))])]),e(B.Z,{staticClass:"text-right"},[t._v(t._s(t._f("yesno")(i.value)))])]]}}])})},L=[],E=(i(7658),i(173)),N=i(7618),V=i(4736),z=i(8463),O=function(){var t=this,e=t._self._c;return e("validation-observer",{ref:"observer"},[e(b.Z,{attrs:{label:t._f("translate")("Create a domain administrator")},on:{change:t.updateCreateAdmin},model:{value:t.createAdmin,callback:function(e){t.createAdmin=e},expression:"createAdmin"}}),e("validation-provider",{attrs:{rules:t.createAdmin?"required":""},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e($.Z,{attrs:{label:t._f("translate")("Name"),hint:t._f("translate")("Name of the administrator"),"persistent-hint":"","error-messages":i,outlined:"",disabled:!t.createAdmin,suffix:`@${t.value.name}`},on:{input:t.update},model:{value:t.form.domain_admin.username,callback:function(e){t.$set(t.form.domain_admin,"username",e)},expression:"form.domain_admin.username"}})]}}])}),e(b.Z,{attrs:{label:t._f("translate")("Random password"),disabled:!t.createAdmin,hint:t._f("translate")("Generate a random password for the administrator."),"persistent-hint":""},on:{change:t.updatePassword,input:t.update},model:{value:t.form.domain_admin.with_random_password,callback:function(e){t.$set(t.form.domain_admin,"with_random_password",e)},expression:"form.domain_admin.with_random_password"}}),e(b.Z,{attrs:{label:t._f("translate")("With a mailbox"),disabled:!t.createAdmin,hint:t._f("translate")("Create a mailbox for the administrator."),"persistent-hint":""},on:{input:t.update},model:{value:t.form.domain_admin.with_mailbox,callback:function(e){t.$set(t.form.domain_admin,"with_mailbox",e)},expression:"form.domain_admin.with_mailbox"}}),e(b.Z,{attrs:{label:t._f("translate")("Create aliases"),disabled:!t.createAdmin,hint:t._f("translate")("Create standard aliases for the domain."),"persistent-hint":""},on:{input:t.update},model:{value:t.form.domain_admin.with_aliases,callback:function(e){t.$set(t.form.domain_admin,"with_aliases",e)},expression:"form.domain_admin.with_aliases"}})],1)},T=[],q=i(9066),P={props:["value"],data(){return{createAdmin:!1,form:{}}},methods:{reset(){this.form={}},updatePassword(t){t?q.Z.getRandomPassword().then((t=>{this.$set(this.form.domain_admin,"password",t.data.password),this.update()})):(delete this.form.domain_admin.password,this.update())},updateCreateAdmin(t){this.$emit("createAdmin",t)},update(){this.$emit("input",this.form)}},watch:{value:{handler:function(t){this.form={...this.value}},immediate:!0}}},R=P,W=(0,D.Z)(R,O,T,!1,null,null,null),M=W.exports,j=i(9467),X={props:["value"],components:{CreationForm:E.Z,"domain-dns-form":N.Z,DomainGeneralForm:V.Z,DomainLimitationsForm:z.Z,DomainOptionsForm:M,DomainTransportForm:j.Z},computed:{summarySections(){const t=[{title:this.$gettext("General"),items:[{key:this.$gettext("Name"),value:this.domain.name},{key:this.$gettext("Type"),value:this.domain.type},{key:this.$gettext("Enabled"),value:this.domain.enabled,type:"yesno"}]},{title:this.$gettext("DNS"),items:[{key:this.$gettext("Enable DNS checks"),value:this.domain.enable_dns_checks,type:"yesno"},{key:this.$gettext("Enable DKIM signing"),value:this.domain.enable_dkim,type:"yesno"}]},{title:this.$gettext("Limitations"),items:[{key:this.$gettext("Quota"),value:this.domain.quota},{key:this.$gettext("Default mailbox quota"),value:this.domain.default_mailbox_quota},{key:this.$gettext("Message sending limit"),value:this.domain.message_limit}]}];if(this.domain.enable_dkim&&(t[1].items.push({key:this.$gettext("DKIM key selector"),value:this.domain.dkim_key_selector}),t[1].items.push({key:this.$gettext("DKIM key length"),value:this.domain.dkim_key_length})),this.createAdmin&&t.push({title:this.$gettext("Options"),items:[{key:this.$gettext("Create a domain administrator"),value:this.createAdmin,type:"yesno"},{key:this.$gettext("Administrator name"),value:this.domain.domain_admin.username},{name:"with_random_password",key:this.$gettext("Random password"),value:this.domain.domain_admin.with_random_password,type:"yesno"},{key:this.$gettext("With mailbox"),value:this.domain.domain_admin.with_mailbox,type:"yesno"},{key:this.$gettext("Create aliases"),value:this.domain.domain_admin.with_aliases,type:"yesno"}]}),"relaydomain"===this.domain.type){const e={title:this.$gettext("Transport"),items:[{key:this.$gettext("Service"),value:this.domain.transport.service}]};if(this.$refs.form_4.service){const t=this.$refs.form_4.service;for(const i of t.settings){const s={key:i.label,value:this.domain.transport.settings[`${t.name}_${i.name}`]};"boolean"===i.type&&(s.type="yesno"),e.items.push(s)}}t.push(e)}return t},steps(){return"domain"===this.domain.type?this.domainSteps:this.relaySteps}},data(){return{createAdmin:!1,domain:{domain_admin:{}},formErrors:{},domainSteps:[{name:"general",title:this.$gettext("General")},{name:"dns",title:this.$gettext("DNS")},{name:"limitations",title:this.$gettext("Limitations")},{name:"options",title:this.$gettext("Options")}],relaySteps:[{name:"general",title:this.$gettext("General")},{name:"dns",title:this.$gettext("DNS")},{name:"limitations",title:this.$gettext("Limitations")},{name:"transport",title:this.$gettext("Transport")}]}},mounted(){this.initDomain()},methods:{copyPassword(){navigator.clipboard.writeText(this.domain.domain_admin.password).then((()=>{Z.$.$emit("notification",{msg:this.$gettext("Password copied to clipboard")})}))},initDomain(){this.domain={name:"",type:"domain",enabled:!0,enable_dns_checks:!0,enable_dkim:!1,dkim_key_selector:"kalabash",quota:0,default_mailbox_quota:0,domain_admin:{username:"admin",with_random_password:!1,with_mailbox:!1,with_aliases:!1},transport:{}}},close(){this.initDomain(),this.$refs.form.resetForm(),this.$emit("close")},getForm(t){return this.$refs[`form_${t}`]},getObserver(t){return this.$refs[`form_${t}`].$refs.observer},validateDomain(){},updateCreateAdmin(t){this.createAdmin=t},submit(){const t=JSON.parse(JSON.stringify(this.domain));this.createAdmin||delete t.domain_admin,"relaydomain"===t.type?this.$refs.form_4.checkSettingTypes(t):delete t.transport,this.$store.dispatch("domains/createDomain",t).then((t=>{this.$router.push({name:"DomainDetail",params:{id:t.data.pk}}),Z.$.$emit("notification",{msg:this.$gettext("Domain created")}),this.close()}))}}},J=X,U=(0,D.Z)(J,I,L,!1,null,null,null),Y=U.exports,K=(i(541),i(6878)),G=i(6669),Q=i(1444),H=i(4971),tt=i(4263),et=i(7678),it=i(5352),st=(0,et.Z)(K.Z,(0,tt.d)(["left","bottom"]),G.Z,Q.Z,H.Z).extend({name:"v-badge",props:{avatar:Boolean,bordered:Boolean,color:{type:String,default:"primary"},content:{required:!1},dot:Boolean,label:{type:String,default:"$vuetify.badge"},icon:String,inline:Boolean,offsetX:[Number,String],offsetY:[Number,String],overlap:Boolean,tile:Boolean,transition:{type:String,default:"scale-rotate-transition"},value:{default:!0}},computed:{classes(){return{"v-badge--avatar":this.avatar,"v-badge--bordered":this.bordered,"v-badge--bottom":this.bottom,"v-badge--dot":this.dot,"v-badge--icon":null!=this.icon,"v-badge--inline":this.inline,"v-badge--left":this.left,"v-badge--overlap":this.overlap,"v-badge--tile":this.tile,...this.themeClasses}},computedBottom(){return this.bottom?"auto":this.computedYOffset},computedLeft(){return this.isRtl?this.left?this.computedXOffset:"auto":this.left?"auto":this.computedXOffset},computedRight(){return this.isRtl?this.left?"auto":this.computedXOffset:this.left?this.computedXOffset:"auto"},computedTop(){return this.bottom?this.computedYOffset:"auto"},computedXOffset(){return this.calcPosition(this.offsetX)},computedYOffset(){return this.calcPosition(this.offsetY)},isRtl(){return this.$vuetify.rtl},offset(){return this.overlap?this.dot?8:12:this.dot?2:4},styles(){return this.inline?{}:{bottom:this.computedBottom,left:this.computedLeft,right:this.computedRight,top:this.computedTop}}},methods:{calcPosition(t){return`calc(100% - ${(0,it.kb)(t||this.offset)})`},genBadge(){const t=this.$vuetify.lang,e=this.$attrs["aria-label"]||t.t(this.label),i=this.setBackgroundColor(this.color,{staticClass:"v-badge__badge",style:this.styles,attrs:{"aria-atomic":this.$attrs["aria-atomic"]||"true","aria-label":e,"aria-live":this.$attrs["aria-live"]||"polite",title:this.$attrs.title,role:this.$attrs.role||"status"},directives:[{name:"show",value:this.isActive}]}),s=this.$createElement("span",i,[this.genBadgeContent()]);return this.transition?this.$createElement("transition",{props:{name:this.transition,origin:this.origin,mode:this.mode}},[s]):s},genBadgeContent(){if(this.dot)return;const t=(0,it.z9)(this,"badge");return t||(this.content?String(this.content):this.icon?this.$createElement(o.Z,this.icon):void 0)},genBadgeWrapper(){return this.$createElement("span",{staticClass:"v-badge__wrapper"},[this.genBadge()])}},render(t){const e=[this.genBadgeWrapper()],i=[(0,it.z9)(this)],{"aria-atomic":s,"aria-label":a,"aria-live":o,role:n,title:r,...l}=this.$attrs;return this.inline&&this.left?i.unshift(e):i.push(e),t("span",{staticClass:"v-badge",attrs:l,class:this.classes},i)}}),at=i(3486),ot=i(4127),nt=i(5151),rt=i(9592),lt=function(){var t=this,e=t._self._c;return e(g.Z,{staticClass:"mt-6"},[e(c.Z,{attrs:{flat:""}},[e(d.Z,{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function({on:i,attrs:a}){return[e(s.Z,t._g(t._b({attrs:{small:""}},"v-btn",a,!1),i),[t._v(" Actions "),e(o.Z,{attrs:{right:""}},[t._v("mdi-chevron-down")])],1)]}}])},[e(n.Z,{attrs:{dense:""}})],1),e(m.Z),e($.Z,{attrs:{"prepend-inner-icon":"mdi-magnify",placeholder:"Search",filled:"",outlined:"",dense:"","hide-details":""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),e(nt.Z,{staticClass:"elevation-1",attrs:{headers:t.headers,items:t.domains,search:t.search,"item-key":"name","show-select":"","single-expand":"",expanded:t.expanded,loading:!t.domainsLoaded},on:{"update:expanded":function(e){t.expanded=e},"item-expanded":t.loadAliases,"click:row":t.showAliases},scopedSlots:t._u([{key:"item",fn:function({item:i,isExpanded:a,expand:n}){return[e("tr",[e("td",[e(at.Z)],1),e("td",[e("router-link",{attrs:{to:{name:"DomainDetail",params:{id:i.pk}}}},[t._v(" "+t._s(i.name)+" ")]),"relaydomain"===i.type?e(ot.Z,{staticClass:"ml-2",attrs:{small:"",color:"primary"}},[e("translate",[t._v("Relay")])],1):t._e(),i.enabled?t._e():e("translate",{staticClass:"ml-2 grey--text"},[t._v("(disabled)")])],1),e("td",[t._v(" "+t._s(i.domainalias_count)+" aliases "),i.domainalias_count?e(s.Z,{attrs:{icon:""},on:{click:function(t){return n(!a)}}},[e(o.Z,a?[t._v("mdi-chevron-up")]:[t._v("mdi-chevron-down")])],1):t._e()],1),e("td",[e("dns-status-chip",{attrs:{status:i.dns_global_status}})],1),e("td",[e(rt.Z,{model:{value:i.allocated_quota_in_percent,callback:function(e){t.$set(i,"allocated_quota_in_percent",e)},expression:"item.allocated_quota_in_percent"}})],1),e("td",[e(rt.Z,{model:{value:i.allocated_quota_in_percent,callback:function(e){t.$set(i,"allocated_quota_in_percent",e)},expression:"item.allocated_quota_in_percent"}})],1),e("td",[e("div",{staticClass:"text-right"},[e(d.Z,{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function({on:a,attrs:n}){return[i.opened_alarms_count?e(st,{attrs:{bordered:"",color:"error",icon:"mdi-bell",overlap:""}},[e(s.Z,t._g(t._b({attrs:{icon:""}},"v-btn",n,!1),a),[e(o.Z,[t._v("mdi-dots-horizontal")])],1)],1):e(s.Z,t._g(t._b({attrs:{icon:""}},"v-btn",n,!1),a),[e(o.Z,[t._v("mdi-dots-horizontal")])],1)]}}],null,!0)},[e("menu-items",{attrs:{items:t.getDomainMenuItems(i),object:i}})],1)],1)])])]}},{key:"expanded-item",fn:function({headers:i,item:s}){return[e("tr",{staticClass:"grey lighten-4"},[e("td",{attrs:{colspan:i.length}},t._l(t.aliases[s.name],(function(i){return e("span",{key:i.name,staticClass:"mr-4"},[e("a",{staticClass:"mr-2",attrs:{href:"#"},on:{click:function(e){return t.editDomainAlias(s,i)}}},[t._v(t._s(i.name))]),e(ot.Z,{attrs:{"x-small":"",color:"success"}},[t._v("DNS OK")])],1)})),0)])]}}]),model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}}),e("confirm-dialog",{ref:"confirm"},[e(at.Z,{attrs:{label:t._f("translate")("Do not delete domain folder"),"hide-details":""},model:{value:t.keepDomainFolder,callback:function(e){t.keepDomainFolder=e},expression:"keepDomainFolder"}})],1),e(a.Z,{attrs:{persistent:"","max-width":"800px"},model:{value:t.showAliasForm,callback:function(e){t.showAliasForm=e},expression:"showAliasForm"}},[e("domain-alias-form",{attrs:{"domain-alias":t.selectedDomainAlias},on:{close:t.closeDomainAliasForm,"alias-created":t.domainAliasCreated,"alias-deleted":t.domainAliasDeleted}})],1),e(a.Z,{attrs:{persistent:"","max-width":"800px"},model:{value:t.showAdminList,callback:function(e){t.showAdminList=e},expression:"showAdminList"}},[e("administrator-list",{attrs:{domain:t.selectedDomain,"dialog-mode":""},on:{close:function(e){t.showAdminList=!1}}})],1)],1)},dt=[],mt=i(322),ct=i(9958),ht=function(){var t=this,e=t._self._c;return e(ot.Z,{attrs:{color:t.chipType,small:""}},[t._v(" "+t._s(t.label)+" ")])},ut=[],pt={props:["status"],computed:{label(){return"disabled"===this.status?this.$gettext("Disabled"):"pending"===this.status?this.$gettext("Pending"):"critical"===this.status?this.$gettext("Problem"):"ok"===this.status?this.$gettext("Valid"):this.$gettext("Unknown")},chipType(){return"disabled"===this.status?"":"pending"===this.status?"info":"critical"===this.status?"error":"ok"===this.status?"success":"warning"}}},ft=pt,gt=(0,D.Z)(ft,ht,ut,!1,null,null,null),_t=gt.exports,vt=i(8658),bt={components:{AdministratorList:mt.Z,ConfirmDialog:ct.Z,"dns-status-chip":_t,DomainAliasForm:S,MenuItems:vt.Z},computed:(0,k.Se)({domains:"domains/domains",domainsLoaded:"domains/domainsLoaded"}),data(){return{headers:[{text:this.$gettext("Name"),value:"name"},{text:this.$gettext("Aliases"),value:"domainalias_count"},{text:this.$gettext("DNS status"),value:"dns_global_status",sortable:!1},{text:this.$gettext("Sending limit"),value:"message_limit"},{text:this.$gettext("Quota"),value:"allocated_quota_in_percent"},{text:this.$gettext("Actions"),value:"actions",sortable:!1,align:"right"}],keepDomainFolder:!1,selectedDomain:null,selectedDomainAlias:null,showAdminList:!1,showConfirmDialog:!1,showAliasForm:!1,search:"",selected:[],expanded:[],aliases:{}}},created(){this.$store.dispatch("domains/getDomains")},methods:{closeDomainAliasForm(){this.showAliasForm=!1,this.selectedDomain=null,this.selectedDomainAlias=null},async deleteDomain(t){const e=await this.$refs.confirm.open(this.$gettext("Warning"),this.$gettextInterpolate("Do you really want to delete the domain %{ domain }?",{domain:t.name}),{color:"error",cancelLabel:this.$gettext("No"),agreeLabel:this.$gettext("Yes")});if(!e)return;const i={keep_folder:this.keepDomainFolder};this.$store.dispatch("domains/deleteDomain",{id:t.pk,data:i}).then((t=>{Z.$.$emit("notification",{msg:this.$gettext("Domain deleted")}),this.keepDomainFolder=!1}))},domainAliasCreated(t){this.$store.dispatch("domains/getDomains")},domainAliasDeleted(){const t=this.aliases[this.selectedDomain.name].filter((t=>t.pk!==this.selectedDomainAlias.pk));this.$set(this.aliases,this.selectedDomain.name,t),t.length||(this.expanded=[]),this.$store.dispatch("domains/getDomains"),this.closeDomainAliasForm()},editDomain(t){this.$router.push({name:"DomainEdit",params:{id:t.pk}})},editDomainAlias(t,e){this.selectedDomain=t,this.selectedDomainAlias=e,this.showAliasForm=!0},loadAliases({item:t,value:e}){e&&f.Z.getDomainAliases(t.name).then((e=>{this.$set(this.aliases,t.name,e.data)}))},openAdminList(t){this.selectedDomain=t,this.showAdminList=!0},showAliases(t){this.expanded=[{item:t}]},getDomainMenuItems(t){const e=[{label:this.$gettext("Administrators"),icon:"mdi-account-supervisor",onClick:this.openAdminList},{label:this.$gettext("Edit"),icon:"mdi-circle-edit-outline",onClick:this.editDomain},{label:this.$gettext("Delete"),icon:"mdi-delete-outline",onClick:this.deleteDomain,color:"red"}];return t.opened_alarms_count&&e.push({label:this.$gettext("Alarms"),icon:"mdi-bell",color:"red",onClick:()=>this.$router.push({name:"Alarms"})}),e}}},$t=bt,xt=(0,D.Z)($t,lt,dt,!1,null,"0b7cef95",null),yt=xt.exports,kt=i(1202),Zt=i(337),At={mixins:[kt.d],components:{DomainAliasForm:S,DomainCreationForm:Y,DomainList:yt,ImportForm:Zt.Z},data(){return{loading:!0,showAliasForm:!1,showDomainWizard:!1,showImportForm:!1}},methods:{exportDomains(){f.Z.exportAll().then((t=>{this.exportContent(t.data,"domains")}))},importDomains(t){this.importContent(f.Z,t)}}},wt=At,Dt=(0,D.Z)(wt,u,p,!1,null,"5e292382",null),Ct=Dt.exports},3694:function(t,e,i){i.d(e,{Z:function(){return c}});var s=i(3434),a=i(6656),o=i(2240),n=i(1444),r=i(6669),l=i(4971),d=i(7678),m=i(4101),c=(0,d.Z)(s.Z,n.Z,l.Z).extend({name:"v-alert",props:{border:{type:String,validator(t){return["top","right","bottom","left"].includes(t)}},closeLabel:{type:String,default:"$vuetify.close"},coloredBorder:Boolean,dense:Boolean,dismissible:Boolean,closeIcon:{type:String,default:"$cancel"},icon:{default:"",type:[Boolean,String],validator(t){return"string"===typeof t||!1===t}},outlined:Boolean,prominent:Boolean,text:Boolean,type:{type:String,validator(t){return["info","error","success","warning"].includes(t)}},value:{type:Boolean,default:!0}},computed:{__cachedBorder(){if(!this.border)return null;let t={staticClass:"v-alert__border",class:{[`v-alert__border--${this.border}`]:!0}};return this.coloredBorder&&(t=this.setBackgroundColor(this.computedColor,t),t.class["v-alert__border--has-color"]=!0),this.$createElement("div",t)},__cachedDismissible(){if(!this.dismissible)return null;const t=this.iconColor;return this.$createElement(a.Z,{staticClass:"v-alert__dismissible",props:{color:t,icon:!0,small:!0},attrs:{"aria-label":this.$vuetify.lang.t(this.closeLabel)},on:{click:()=>this.isActive=!1}},[this.$createElement(o.Z,{props:{color:t}},this.closeIcon)])},__cachedIcon(){return this.computedIcon?this.$createElement(o.Z,{staticClass:"v-alert__icon",props:{color:this.iconColor}},this.computedIcon):null},classes(){const t={...s.Z.options.computed.classes.call(this),"v-alert--border":Boolean(this.border),"v-alert--dense":this.dense,"v-alert--outlined":this.outlined,"v-alert--prominent":this.prominent,"v-alert--text":this.text};return this.border&&(t[`v-alert--border-${this.border}`]=!0),t},computedColor(){return this.color||this.type},computedIcon(){return!1!==this.icon&&("string"===typeof this.icon&&this.icon?this.icon:!!["error","info","success","warning"].includes(this.type)&&`$${this.type}`)},hasColoredIcon(){return this.hasText||Boolean(this.border)&&this.coloredBorder},hasText(){return this.text||this.outlined},iconColor(){return this.hasColoredIcon?this.computedColor:void 0},isDark(){return!(!this.type||this.coloredBorder||this.outlined)||r.Z.options.computed.isDark.call(this)}},created(){this.$attrs.hasOwnProperty("outline")&&(0,m.fK)("outline","outlined",this)},methods:{genWrapper(){const t=[this.$slots.prepend||this.__cachedIcon,this.genContent(),this.__cachedBorder,this.$slots.append,this.$scopedSlots.close?this.$scopedSlots.close({toggle:this.toggle}):this.__cachedDismissible],e={staticClass:"v-alert__wrapper"};return this.$createElement("div",e,t)},genContent(){return this.$createElement("div",{staticClass:"v-alert__content"},this.$slots.default)},genAlert(){let t={staticClass:"v-alert",attrs:{role:"alert"},on:this.listeners$,class:this.classes,style:this.styles,directives:[{name:"show",value:this.isActive}]};if(!this.coloredBorder){const e=this.hasText?this.setTextColor:this.setBackgroundColor;t=e(this.computedColor,t)}return this.$createElement("div",t,[this.genWrapper()])},toggle(){this.isActive=!this.isActive}},render(t){const e=this.genAlert();return this.transition?t("transition",{props:{name:this.transition,origin:this.origin,mode:this.mode}},[e]):e}})},4971:function(t,e,i){var s=i(144);e["Z"]=s.ZP.extend({name:"transitionable",props:{mode:String,origin:String,transition:String}})},9066:function(t,e,i){var s=i(2201);const a="accounts";e["Z"]={getAll({domain:t,role:e}){return s.Z.get(`/${a}/`,{params:{domain:t,role:e}})},get(t){return s.Z.get(`${a}/${t}/`)},getRandomPassword(){return s.Z.get(`${a}/random_password`)},validate(t){return s.Z.post(`${a}/validate/`,t)},create(t){return s.Z.post(`${a}/`,t)},patch(t,e){return s.Z.patch(`${a}/${t}/`,e)},delete(t,e){return s.Z.post(`${a}/${t}/delete/`,e)}}},1202:function(t,e,i){i.d(e,{d:function(){return a}});var s=i(5282);const a={methods:{exportContent(t,e){const i=new Blob([t],{type:"text/csv"}),s=document.createElement("a");s.href=URL.createObjectURL(i),s.download=`kalabash-${e}.csv`,s.click(),URL.revokeObjectURL(s.href)},importContent(t,e){t.importFromCSV(e).then((t=>{t.data.status?(s.$.$emit("notification",{msg:t.data.message}),this.$refs.importForm.close()):s.$.$emit("notification",{msg:t.data.message,type:"error"})})).catch((()=>{s.$.$emit("notification",{msg:this.$gettext("CSV seems to be badly formatted"),type:"error"})}))}}}}}]);
//# sourceMappingURL=761.95bfd14c.js.map