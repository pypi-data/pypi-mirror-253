"use strict";(self["webpackChunkKalabash"]=self["webpackChunkKalabash"]||[]).push([[580],{7810:function(e,t,r){r.r(t),r.d(t,{default:function(){return I}});var s=r(4562),i=r(4061),o=r(4324),n=r(3687),a=r(6313),d=r(7953),l=function(){var e=this,t=e._self._c;return t("div",[t(a.Z,{attrs:{flat:""}},[t(d.qW,[t("translate",[e._v("Providers")])],1),t(n.Z),t(s.Z,{attrs:{"offset-y":"",color:"primary"},on:{click:function(t){e.showProviderWizard=!0}}},[t(o.Z,{attrs:{left:""}},[e._v("mdi-plus")]),t("translate",[e._v("New")])],1)],1),t("providers-list"),t(i.Z,{attrs:{fullscreen:"",scrollable:"",transition:"dialog-bottom-transition"},scopedSlots:e._u([{key:"help",fn:function(){return[t("ul",[t("li",[t("em",[e._v("domain; name; quota; default mailbox quota; enabled")])]),t("li",[t("em",[e._v("domainalias; name; targeted domain; enabled")])])])]},proxy:!0}]),model:{value:e.showProviderWizard,callback:function(t){e.showProviderWizard=t},expression:"showProviderWizard"}},[t("provider-creation-form",{on:{close:function(t){e.showProviderWizard=!1}}})],1)],1)},m=[],c=function(){var e=this,t=e._self._c;return t("creation-form",{ref:"form",attrs:{title:e._f("translate")("New provider"),steps:e.steps,"form-observer-getter":e.getObserver,"form-getter":e.getForm,"validate-object":e.validateProvider,"summary-sections":e.summarySections},on:{close:e.close,create:e.submit},scopedSlots:e._u([{key:"form.general",fn:function({step:r}){return[t("provider-general-form",{ref:`form_${r}`,model:{value:e.provider,callback:function(t){e.provider=t},expression:"provider"}})]}},{key:"form.associated",fn:function({step:r}){return[t("provider-associated-form",{ref:`form_${r}`,model:{value:e.provider.domains,callback:function(t){e.$set(e.provider,"domains",t)},expression:"provider.domains"}})]}}])})},u=[],v=(r(7658),r(5282)),h=r(173),p=r(8231),f=r(3060),_={props:["value"],components:{CreationForm:h.Z,"provider-associated-form":p.Z,ProviderGeneralForm:f.Z},computed:{associatedDomainsSummary(){const e=[];for(const t of this.provider.domains){const r=t.new_domain?`${t.name} => ${t.new_domain.name}`:t.name;e.push({key:"",value:r})}return e},summarySections(){const e=[{title:this.$gettext("General"),items:[{key:this.$gettext("Name"),value:this.provider.name},{key:this.$gettext("Address"),value:this.provider.address},{key:this.$gettext("Port"),value:this.provider.port},{key:this.$gettext("Secured"),value:this.provider.secured,type:"yesno"}]},{title:this.$gettext("Associated domains"),items:this.associatedDomainsSummary}];return e},steps(){return[{name:"general",title:this.$gettext("General")},{name:"associated",title:this.$gettext("Associated domains")}]}},data(){return{provider:{domains:[]},formErrors:{}}},mounted(){this.initProvider()},methods:{initProvider(){this.provider={name:"",address:"",port:993,secured:!0,domains:[]}},close(){this.initProvider(),this.$refs.form.resetForm(),this.$emit("close")},getForm(e){return this.$refs[`form_${e}`]},getObserver(e){return this.$refs[`form_${e}`].$refs.observer},validateProvider(){},submit(){const e={...this.provider};e.domains=[];for(const t of this.provider.domains)t.new_domain?e.domains.push({name:t.name,new_domain:t.new_domain.pk}):e.domains.push(t);this.$store.dispatch("providers/createProvider",e).then((()=>{v.$.$emit("notification",{msg:this.$gettext("Provider created")}),this.close()}))}}},g=_,x=r(1001),$=(0,x.Z)(g,c,u,!1,null,null,null),k=$.exports,b=r(4145),y=r(4127),Z=r(5151),P=r(5808),w=r(4528),S=r(7808),A=function(){var e=this,t=e._self._c;return t(b.Z,{staticClass:"mt-6"},[t(a.Z,{attrs:{flat:""}},[t(w.Z,{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:r,attrs:i}){return[t(s.Z,e._g(e._b({attrs:{small:""}},"v-btn",i,!1),r),[e._v(" Actions "),t(o.Z,{attrs:{right:""}},[e._v("mdi-chevron-down")])],1)]}}])},[t(P.Z,{attrs:{dense:""}})],1),t(n.Z),t(S.Z,{attrs:{"prepend-inner-icon":"mdi-magnify",placeholder:"Search",filled:"",outlined:"",dense:"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),t(Z.Z,{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.providers,search:e.search,"item-key":"name","single-expand":"",expanded:e.expanded,"show-select":""},on:{"update:expanded":function(t){e.expanded=t},"click:row":(e,t)=>t.expand(!t.isExpanded)},scopedSlots:e._u([{key:"item.secured",fn:function({item:r}){return[!0===r.secured?t(o.Z,{attrs:{color:"green"}},[e._v(" mdi-lock ")]):t(o.Z,{attrs:{color:"red"}},[e._v(" mdi-lock-off ")])]}},{key:"item.domains",fn:function({item:r}){return[r.domains.length>0?t(y.Z,[e._v(" "+e._s(r.domains.length)+" associated domain(s) ")]):t(y.Z,[e._v(" No associated domain ")])]}},{key:"expanded-item",fn:function({headers:r,item:s}){return[t("td",{attrs:{colspan:r.length}},e._l(s.domains,(function(r,s){return t(y.Z,{key:s},[r.new_domain?[e._v(" "+e._s(r.name)+" --\x3e "+e._s(r.new_domain.name)+" ")]:[e._v(" "+e._s(r.name)+" --\x3e "+e._s(r.name)+" ")]],2)})),1)]}},{key:"item.actions",fn:function({item:r}){return[t(w.Z,{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:r,attrs:i}){return[t(s.Z,e._g(e._b({attrs:{icon:""}},"v-btn",i,!1),r),[t(o.Z,[e._v("mdi-dots-horizontal")])],1)]}}],null,!0)},[t("menu-items",{attrs:{items:e.getMenuItems(r),object:r}})],1)]}}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1)},C=[],z=r(629),W=r(8658),F={components:{MenuItems:W.Z},computed:(0,z.Se)({providers:"providers/providers"}),data(){return{headers:[{text:this.$gettext("Name"),value:"name"},{text:this.$gettext("Address"),value:"address"},{text:this.$gettext("Port"),value:"port"},{text:this.$gettext("Secured"),value:"secured"},{text:this.$gettext("Associated domains"),value:"domains"},{text:this.$gettext("Actions"),value:"actions",sortable:!1,align:"right"}],selected:[],search:"",expanded:[]}},methods:{deleteProvider(e){this.$store.dispatch("providers/deleteProvider",{id:e.id}).then((e=>{v.$.$emit("notification",{msg:this.$gettext("Provider deleted")})}))},editProvider(e){this.$router.push({name:"ProviderEdit",params:{id:e.id}})},loadAssociatedDomains({item:e,value:t}){t&&this.$set(this.item.domains)},getMenuItems(e){const t=[];return t.push({label:this.$gettext("Delete"),icon:"mdi-delete-outline",onClick:this.deleteProvider,color:"red"}),t.push({label:this.$gettext("Edit"),icon:"mdi-circle-edit-outline",onClick:this.editProvider}),t}},created(){this.$store.dispatch("providers/getProviders")}},M=F,N=(0,x.Z)(M,A,C,!1,null,null,null),D=N.exports,E={components:{ProviderCreationForm:k,ProvidersList:D},data(){return{showProviderWizard:!1}}},q=E,G=(0,x.Z)(q,l,m,!1,null,"4c05659b",null),I=G.exports}}]);
//# sourceMappingURL=580.c5076759.js.map