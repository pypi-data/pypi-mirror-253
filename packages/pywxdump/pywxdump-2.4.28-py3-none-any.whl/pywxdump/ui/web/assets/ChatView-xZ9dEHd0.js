import{C as Y,_ as Z}from"./ChatRecprdsHeader-uzGfj8bS.js";import{d as V,o as a,c as r,a as e,t as S,_ as I,r as o,b as G,h as E,e as $,f as l,u as D,i as z,w as J,g as M,j as O,k as K,F as ee,l as te,n as N,m as L,p as P,v as W,E as se,q as ne,s as j,x as ae,y as le}from"./index-eRuYJV5r.js";const oe={class:"chat-content"},ie={key:0,class:"word"},re=["src"],ce={class:"info"},de={class:"time"},ue=["innerHTML"],_e={key:1,class:"word-my"},he={class:"info"},ve={class:"time"},pe=["innerHTML"],me=["src"],fe=V({__name:"MessageText",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(t){const h=n=>(n=n.replace(/\n/g,"<br>"),new DOMParser().parseFromString(n,"text/html").body.innerHTML);return(n,i)=>(a(),r("div",oe,[t.is_sender?(a(),r("div",_e,[e("div",he,[e("p",ve,S(t.direction),1),e("div",{class:"info-content",innerHTML:h(t.content)},null,8,pe)]),e("img",{src:t.headUrl},null,8,me)])):(a(),r("div",ie,[e("img",{src:t.headUrl},null,8,re),e("div",ce,[e("p",de,S(t.direction),1),e("div",{class:"info-content",innerHTML:h(t.content)},null,8,ue)])]))]))}}),ye=I(fe,[["__scopeId","data-v-d930be9e"]]),ge={class:"chat-content"},we={key:0,class:"word"},xe=["src"],be={class:"info"},$e={class:"time"},ke={class:"demo-image__preview"},Me={key:1,class:"word-my"},Se={class:"info"},Te={class:"time"},Ue={class:"demo-image__preview"},De=["src"],Ve=V({__name:"MessageImg",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){const h=t,n=o("");G(async()=>{n.value=await i(h.src)});const i=async v=>{try{return await E.post("/api/img",{img_path:v})}catch(p){return console.error("Error fetching data:",p),""}};return(v,p)=>{const w=$("el-image");return a(),r("div",ge,[t.is_sender?(a(),r("div",Me,[e("div",Se,[e("p",Te,S(t.direction),1),e("div",Ue,[l(w,{style:{"max-width":"150px","max-height":"150px"},src:n.value,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[n.value],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),e("img",{src:t.headUrl},null,8,De)])):(a(),r("div",we,[e("img",{src:t.headUrl},null,8,xe),e("div",be,[e("p",$e,S(t.direction),1),e("div",ke,[l(w,{style:{"max-width":"150px","max-height":"150px"},src:n.value,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[n.value],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),Ce=I(Ve,[["__scopeId","data-v-2190d708"]]),He={class:"chat-content"},Le={key:0,class:"word"},je=["src"],Ee={class:"info"},Ie={class:"time"},Re={controls:"",style:{"background-color":"#fff"}},Oe=["src"],Ne={key:1,class:"word-my"},qe={class:"info"},Ae={class:"time"},Be={controls:"",style:{"background-color":"#95EC69"}},Fe=["src"],ze=["src"],Pe=V({__name:"MessageAudio",props:{is_sender:{type:Number,default:0},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""},msg:{type:String,default:""}},setup(t){return(h,n)=>(a(),r("div",He,[t.is_sender?(a(),r("div",Ne,[e("div",qe,[e("p",Ae,S(t.direction),1),e("audio",Be,[e("source",{src:t.src,type:"audio/wav"},null,8,Fe)]),l(D(z),{rows:1,readonly:!0,value:t.msg,style:{width:"100%"}},null,8,["value"])]),e("img",{src:t.headUrl},null,8,ze)])):(a(),r("div",Le,[e("img",{src:t.headUrl},null,8,je),e("div",Ee,[e("p",Ie,S(t.direction),1),e("audio",Re,[e("source",{src:t.src,type:"audio/wav"},null,8,Oe)]),l(D(z),{rows:1,readonly:!0,value:t.msg,style:{width:"100%"}},null,8,["value"])])]))]))}}),We=I(Pe,[["__scopeId","data-v-0d0f2cd4"]]),Ge={class:"chat-content"},Je={key:0,class:"word"},Ke=["src"],Qe={class:"info"},Xe={class:"time"},Ye=["innerHTML"],Ze={key:1,class:"word-my"},et={class:"info"},tt={class:"time"},st=["innerHTML"],nt=["src"],at=V({__name:"MessageOther",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(t){const h=n=>(n=n.replace(/\n/g,"<br>"),new DOMParser().parseFromString(n,"text/html").body.innerHTML);return(n,i)=>(a(),r("div",Ge,[t.is_sender?(a(),r("div",Ze,[e("div",et,[e("p",tt,S(t.direction),1),e("div",{class:"info-content",innerHTML:h(t.content)},null,8,st)]),e("img",{src:t.headUrl},null,8,nt)])):(a(),r("div",Je,[e("img",{src:t.headUrl},null,8,Ke),e("div",Qe,[e("p",Xe,S(t.direction),1),e("div",{class:"info-content",innerHTML:h(t.content)},null,8,Ye)])]))]))}}),lt=I(at,[["__scopeId","data-v-e529325a"]]),ot={id:"chat"},it={class:"chat_body"},rt={class:"chat_window",ref:"chatWindow"},ct={key:0,class:"load_more",style:{display:"flex","justify-content":"center","margin-top":"10px","margin-bottom":"10px"}},dt=V({__name:"ChatRecordsMain",props:{userData:{type:Object,required:!0},setScrollTop:{type:Function,required:!0},updateScrollTop:{type:Function,required:!0}},setup(t,{expose:h}){const n=t,i=o([]),v=o({}),p=o(""),w=o(50),u=o(0),y=o(!1),T=async(c,x,d)=>{try{const s=await E.post("/api/msgs",{start:c,limit:x,wxid:d});return i.value=s.msg_list,v.value=s.user_list,p.value=s.my_wxid,s}catch(s){return console.error("Error fetching data:",s),[]}},U=async()=>{try{u.value=n.userData.chat_count-w.value,await T(u.value,w.value,n.userData.username),y.value||await N(()=>{n.setScrollTop(),y.value=!1})}catch(c){return console.error("Error fetching data:",c),[]}};G(U),J(()=>n.userData.username,(c,x)=>{i.value=[],y.value=!1,U()});const m=c=>(c.talker=="我"&&(c.talker=p.value),`${(d=>v.value.hasOwnProperty(d.talker)?v.value[d.talker].remark?v.value[d.talker].remark:v.value[d.talker].nickname?v.value[d.talker].nickname:v.value[d.talker].account?v.value[d.talker].account:d.talker:d.talker)(c)} [${c.type_name}] ${c.CreateTime}`),k=c=>(c.talker=="我"&&(c.talker=p.value),v.value.hasOwnProperty(c.talker)?v.value[c.talker].headImgUrl:""),C=async()=>{let c=w.value,x=u.value-c;const d=await E.post("/api/msgs",{start:x,limit:c,wxid:n.userData.username});u.value=x,i.value=d.msg_list.concat(i.value),i.value.sort((s,g)=>s.id-g.id),i.value=i.value.filter((s,g,R)=>g===0||s.id!==R[g-1].id),v.value=Object.assign(v.value,d.user_list),await N(()=>{n.updateScrollTop()})};return h({loadMore:C}),(c,x)=>{const d=$("el-button");return a(),r("div",ot,[e("div",it,[e("div",rt,[i.value.length<t.userData.chat_count?(a(),r("div",ct,[l(d,{type:"primary",onClick:C},{default:M(()=>[O("查看更多消息")]),_:1})])):K("",!0),(a(!0),r(ee,null,te(i.value,(s,g)=>(a(),r("div",{class:"message",key:g},[s.type_name=="文本"?(a(),L(ye,{key:0,is_sender:s.is_sender,direction:m(s),headUrl:k(s),content:s.content.msg},null,8,["is_sender","direction","headUrl","content"])):s.type_name=="图片"?(a(),L(Ce,{key:1,is_sender:s.is_sender,direction:m(s),headUrl:k(s),src:s.content.src},null,8,["is_sender","direction","headUrl","src"])):s.type_name=="语音"?(a(),L(We,{key:2,is_sender:s.is_sender,direction:m(s),headUrl:k(s),src:"api/"+s.content.src,msg:s.content.msg},null,8,["is_sender","direction","headUrl","src","msg"])):(a(),L(lt,{key:3,is_sender:s.is_sender,direction:m(s),headUrl:k(s),content:s.content.msg},null,8,["is_sender","direction","headUrl","content"]))]))),128))],512)])])}}}),ut=I(dt,[["__scopeId","data-v-5b962a8e"]]),_t=V({__name:"ChatRecords",props:{userData:{type:Object,required:!0}},setup(t){const h=o(null),n=o(null);o(0);const i=o(0),v=()=>{N(()=>{if(h.value){const u=h.value.$el.children[0];u&&(u.scrollTop=u.scrollHeight,i.value=u.scrollHeight)}})},p=()=>{const u=h.value.$el.children[0];if(u){const y=i.value,T=u.scrollHeight-y;u.scrollTop=u.scrollTop+T,i.value=u.scrollHeight}};function w({scrollTop:u}){u===0&&n.value&&n.value.loadMore()}return(u,y)=>{const T=$("el-header"),U=$("el-scrollbar"),m=$("el-main"),k=$("el-container");return a(),L(k,null,{default:M(()=>[l(T,{style:{height:"65px","max-height":"65px",width:"100%","background-color":"#d2d2fa","padding-top":"5px"}},{default:M(()=>[l(Y,{userData:t.userData},null,8,["userData"])]),_:1}),l(m,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:M(()=>[l(U,{ref_key:"scrollbarRef",ref:h,onScroll:w},{default:M(()=>[l(ut,{ref_key:"chatRecordsMainRef",ref:n,userData:t.userData,setScrollTop:v,updateScrollTop:p},null,8,["userData"])]),_:1},512)]),_:1})]),_:1})}}}),ht={style:{"background-color":"#d2d2fa",height:"100vh",display:"flex","justify-content":"center","align-items":"center"}},vt={key:0},pt={key:1,style:{"background-color":"#fff",width:"90%","min-width":"800px",height:"80%","border-radius":"10px",padding:"20px",overflow:"auto"}},mt=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"选择要查看的微信")],-1),ft={style:{"margin-top":"20px"}},yt={style:{"margin-top":"20px"}},gt={key:1},wt={style:{"background-color":"#fff",width:"70%","min-width":"800px",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},xt=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"自定义-文件位置"),e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),bt={style:{"margin-top":"20px"}},$t=e("label",null,"MicroMsg.db路径: ",-1),kt=e("br",null,null,-1),Mt=e("label",null,"MSG.db路径: ",-1),St=e("br",null,null,-1),Tt=e("label",null,"MediaMSG.db路径: ",-1),Ut=e("br",null,null,-1),Dt=e("label",null,"微信文件夹路径: ",-1),Vt=e("br",null,null,-1),Ct=e("label",null,"微信原始id: ",-1),Ht=e("br",null,null,-1),Lt=e("label",null,"密钥key(可空): ",-1),jt=e("br",null,null,-1),Et={key:2,style:{display:"flex","justify-content":"space-between"}},It={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px","margin-right":"20px"}},Rt=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"自动解密已登录微信")],-1),Ot={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px"}},Nt=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"自定义文件位置")],-1),qt=V({__name:"IsAutoShow",emits:["isAutoShow"],setup(t,{emit:h}){const n=o(0),i=o(500),v=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#6f7ad3",percentage:100}],p=o(new Date().getTime()),w=()=>{k.value||(p.value=new Date().getTime(),!(n.value>=99)&&(n.value>=80&&(i.value=i.value+50),n.value=n.value+1,setTimeout(w,i.value)))},u=o(!1),y=o([]),T=o(""),U=o(!1),m=o(""),k=o(!1),C=o(""),c=o(""),x=o(""),d=o(""),s=o(""),g=o(""),R=h,Q=async()=>{try{y.value=await E.post("/api/wxinfo"),y.value.length===1&&(q(y.value[0]),T.value=" (检测到只有一个微信，将在5秒后自动选择) ",setTimeout(A,5e3))}catch(b){return console.error("Error fetching data:",b),[]}},q=async b=>{C.value="",c.value="",x.value="",d.value=b.filePath,s.value=b.key,g.value=b.wxid},A=()=>{d.value===""&&s.value===""&&g.value===""||U.value||(console.log(d.value,s.value,g.value),U.value=!0,B(),w())},B=async()=>{try{let b={msg_path:C.value,micro_path:c.value,media_path:x.value,wx_path:d.value,key:s.value,my_wxid:g.value};const _=await E.post("/api/init",b);u.value=_.is_init,_.is_init&&(n.value=100),R("isAutoShow",_.is_init)}catch(b){return n.value=0,k.value=!0,se.alert(b,"error",{confirmButtonText:"确认",callback:_=>{ne({type:"error",message:`action: ${_}`})}}),[]}};return J(m,b=>{b==="auto"&&Q()}),(b,_)=>{const X=$("el-progress"),F=$("el-button"),H=$("el-input");return a(),r("div",ht,[m.value==="auto"?(a(),r("div",vt,[U.value&&!k.value?(a(),L(X,{key:0,type:"dashboard",percentage:n.value,color:v},null,8,["percentage"])):(a(),r("div",pt,[mt,e("div",ft,[l(D(ae),{data:y.value,onCurrentChange:q,"highlight-current-row":"",style:{width:"100%"}},{default:M(()=>[l(D(j),{"min-width":30,prop:"pid",label:"进程id"}),l(D(j),{"min-width":40,prop:"version",label:"微信版本"}),l(D(j),{"min-width":40,prop:"account",label:"账号"}),l(D(j),{"min-width":40,prop:"name",label:"昵称"}),l(D(j),{"min-width":50,prop:"wxid",label:"微信原始id"})]),_:1},8,["data"])]),e("div",yt,[l(F,{style:{"margin-right":"10px","margin-top":"10px",width:"100%"},type:"success",onClick:A},{default:M(()=>[O("确定"+S(T.value),1)]),_:1})])]))])):m.value==="custom"?(a(),r("div",gt,[e("div",wt,[xt,e("div",bt,[$t,l(H,{placeholder:"MicroMsg.db",modelValue:c.value,"onUpdate:modelValue":_[0]||(_[0]=f=>c.value=f),style:{width:"50%"}},null,8,["modelValue"]),kt,Mt,l(H,{placeholder:"MSG.db",modelValue:C.value,"onUpdate:modelValue":_[1]||(_[1]=f=>C.value=f),style:{width:"50%"}},null,8,["modelValue"]),St,Tt,l(H,{placeholder:"MediaMSG.db",modelValue:x.value,"onUpdate:modelValue":_[2]||(_[2]=f=>x.value=f),style:{width:"50%"}},null,8,["modelValue"]),Ut,Dt,l(H,{placeholder:"C:\\***\\WeChat Files\\wxid_*******",modelValue:d.value,"onUpdate:modelValue":_[3]||(_[3]=f=>d.value=f),style:{width:"50%"}},null,8,["modelValue"]),Vt,Ct,l(H,{placeholder:"wxid_*******",modelValue:g.value,"onUpdate:modelValue":_[4]||(_[4]=f=>g.value=f),style:{width:"50%"}},null,8,["modelValue"]),Ht,Lt,l(H,{placeholder:"密钥key【64位，可为空，空表示上诉数据库已解密】",modelValue:s.value,"onUpdate:modelValue":_[5]||(_[5]=f=>s.value=f),style:{width:"50%"}},null,8,["modelValue"]),jt,l(F,{style:{"margin-top":"10px",width:"50%"},type:"success",onClick:B},{default:M(()=>[O("确定")]),_:1})])])])):m.value===""?(a(),r("div",Et,[e("label",It,[P(e("input",{type:"radio","onUpdate:modelValue":_[6]||(_[6]=f=>m.value=f),value:"auto"},null,512),[[W,m.value]]),Rt]),e("label",Ot,[P(e("input",{type:"radio","onUpdate:modelValue":_[7]||(_[7]=f=>m.value=f),value:"custom"},null,512),[[W,m.value]]),Nt])])):K("",!0)])}}}),At={id:"chat_view",class:"common-layout"},Bt={key:0},Ft={key:1},zt={key:0,style:{height:"calc(100vh)",width:"100%"}},Pt={key:1,style:{width:"100%",height:"100%"}},Jt=V({__name:"ChatView",setup(t){const h=o({account:"",describe:"",headImgUrl:"",nickname:"",remark:"",username:"",chat_count:0}),n=p=>{h.value=p},i=o(!1),v=p=>{i.value=p};return(p,w)=>{const u=$("el-aside"),y=$("el-container");return a(),r("div",At,[i.value?(a(),r("div",Ft,[l(y,null,{default:M(()=>[l(u,{width:"266px",style:{"overflow-y":"auto",height:"calc(100vh)"}},{default:M(()=>[l(Z,{onUserData:n})]),_:1}),h.value.username!=""?(a(),r("div",zt,[l(_t,{userData:h.value},null,8,["userData"])])):(a(),r("div",Pt,[l(le)]))]),_:1})])):(a(),r("div",Bt,[l(qt,{onIsAutoShow:v})]))])}}});export{Jt as default};
