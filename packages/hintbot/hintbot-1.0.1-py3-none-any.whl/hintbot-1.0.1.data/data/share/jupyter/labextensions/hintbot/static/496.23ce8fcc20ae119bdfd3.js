"use strict";(self.webpackChunkhintbot=self.webpackChunkhintbot||[]).push([[496],{496:(e,t,n)=>{n.r(t),n.d(t,{default:()=>p});var o=n(372),a=n(392),i=n(678),r=n(778),s=n(770),l=n(29),d=n.n(l);class c extends i.ReactWidget{constructor(e){super(),this._message="",this._message=e}getValue(){var e;return null===(e=this.node.querySelector("textarea"))||void 0===e?void 0:e.value}render(){return d().createElement("div",{className:"reflection"},d().createElement("label",null,this._message,d().createElement("textarea",{name:"reflection-input",className:"reflection-input",rows:10})))}}const u=e=>(0,i.showDialog)({title:"Reflection",body:new c(e),buttons:[i.Dialog.createButton({label:"Cancel"}),i.Dialog.createButton({label:"Submit"})],hasClose:!1});var m=n(170),h=n(387);async function b(e="",t={}){const n=h.ServerConnection.makeSettings(),o=m.URLExt.join(n.baseUrl,"hintbot",e);let a;try{a=await h.ServerConnection.makeRequest(o,t,n)}catch(e){throw new h.ServerConnection.NetworkError(e)}let i=await a.text();if(i.length>0)try{i=JSON.parse(i)}catch(e){console.log("Not a JSON response body.",a)}if(!a.ok)throw new h.ServerConnection.ResponseError(a,i.message||i);return i}const g=async(e,t,n,o)=>{var a;const r=null===(a=o.getMetadata("nbgrader"))||void 0===a?void 0:a.grade_id,s=o.getMetadata("remaining_hints");if(document.getElementById("hint-banner"))(0,i.showDialog)({title:"Please review previous hint first.",buttons:[i.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]}),n.exporters.forEach((t=>{n.publishEvent(e,{eventName:"HintAlreadyExists",eventTime:Date.now(),eventInfo:{gradeId:r}},t,!1)}));else if(s<1)(0,i.showDialog)({title:"No hint left for this question.",buttons:[i.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]}),n.exporters.forEach((t=>{n.publishEvent(e,{eventName:"NotEnoughHint",eventTime:Date.now(),eventInfo:{gradeId:r}},t,!1)}));else{const a=t.get("preReflection").composite,l=t.get("postReflection").composite;if((async(e,t,n,o)=>{var a;const r=n.getMetadata("nbgrader").grade_id,s=document.createElement("div");s.id="hint-banner-placeholder",e.content.node.insertBefore(s,e.content.node.firstChild);const l=document.createElement("div");l.id="hint-banner",null===(a=e.content.node.parentElement)||void 0===a||a.insertBefore(l,e.content.node),l.innerHTML='<p><span class="loader"></span>Retrieving hint... Please do not refresh the page.</p> <p>It usually takes around 2 minutes to generate a hint. You may continue to work on the assignment in the meantime.</p>';const d=document.createElement("div");d.id="hint-banner-cancel-button",d.innerText="Cancel request",l.appendChild(d),d.onclick=async()=>{await b("hint",{method:"POST",body:JSON.stringify({resource:"cancel",problem_id:r})})};try{const n=await b("hint",{method:"POST",body:JSON.stringify({resource:"req",problem_id:r,buggy_notebook_path:e.context.path})}),a=n.feedback;if(n.job_finished&&n.feedback){t.exporters.forEach((n=>{t.publishEvent(e,{eventName:"HintRequestCompleted",eventTime:Date.now(),eventInfo:{hintContent:a,gradeId:r}},n,!0)})),l.innerText=a,d.remove();const n=document.createElement("div");n.id="hint-banner-buttons-container";const i=document.createElement("div");i.id="hint-banner-buttons";const c=document.createElement("button");c.classList.add("hint-banner-button"),c.innerText="Helpful ðŸ‘";const m=document.createElement("button");m.classList.add("hint-banner-button"),m.innerText="Unhelpful ðŸ‘Ž";const h=async n=>{if(t.exporters.forEach((o=>{t.publishEvent(e,{eventName:"HintEvaluated",eventTime:Date.now(),eventInfo:{gradeId:r,hintContent:a,evaluation:n}},o,!0)})),o){const n=await u("Write a brief statement of what you learned from the hint and how you will use it to solve the problem.");"Submit"===n.button.label&&(l.remove(),s.remove()),t.exporters.forEach((o=>{t.publishEvent(e,{eventName:"PostReflection",eventTime:Date.now(),eventInfo:{status:n.button.label,gradeId:r,hintContent:a,reflection:n.value}},o,!0)}))}else l.remove(),s.remove()};c.onclick=()=>{h("helpful")},m.onclick=()=>{h("unhelpful")},i.appendChild(m),i.appendChild(c),n.appendChild(i),l.appendChild(n)}else n.job_finished||"cancelled"!==n.feedback?(l.remove(),s.remove(),(0,i.showDialog)({title:"Hint Request Error. Please try again later",buttons:[i.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]}),t.exporters.forEach((n=>{t.publishEvent(e,{eventName:"HintRequestError",eventTime:Date.now(),eventInfo:{gradeId:r}},n,!1)}))):(l.remove(),s.remove(),(0,i.showDialog)({title:"Hint Request Cancelled",buttons:[i.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]}),t.exporters.forEach((n=>{t.publishEvent(e,{eventName:"HintRequestCancelled",eventTime:Date.now(),eventInfo:{gradeId:r}},n,!1)})))}catch(n){console.log(n),l.remove(),s.remove(),(0,i.showDialog)({title:"Hint Request Error. Please try again later",buttons:[i.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]}),t.exporters.forEach((n=>{t.publishEvent(e,{eventName:"HintRequestError",eventTime:Date.now(),eventInfo:{gradeId:r}},n,!1)}))}})(e,n,o,l),o.setMetadata("remaining_hints",s-1),document.getElementById(r).innerText=`Hint (${s-1} left for this question)`,e.context.save(),a){document.getElementById("hint-banner").style.filter="blur(10px)";const t=await u("Write a brief statement of what the problem is that you are facing and why you think your solution is not working.");document.getElementById("hint-banner").style.filter="none",n.exporters.forEach((o=>{n.publishEvent(e,{eventName:"PreReflection",eventTime:Date.now(),eventInfo:{status:t.button.label,gradeId:r,reflection:t.value}},o,!0)})),"Cancel"===t.button.label&&await b("hint",{method:"POST",body:JSON.stringify({resource:"cancel",problem_id:r})})}}},v={id:"hintbot:plugin",description:"A JupyterLab extension.",autoStart:!0,requires:[a.INotebookTracker,o.ISettingRegistry,s.IJupyterLabPioneer],activate:async(e,t,n,o)=>{const a=document.createElement("button");a.innerText="Activate HintBot Extension",a.id="hintbot-activation-button";const s=document.createElement("div");s.appendChild(a);const l=await n.load(v.id);t.widgetAdded.connect((async(e,t)=>{await t.revealed,await o.loadExporters(t),t.toolbar.insertAfter("spacer","hintbot-activation-button",new r.Widget({node:s})),a.onclick=async()=>{"Confirm activation"===(await(0,i.showDialog)({body:"The hintbot extension is a prototype and not required to be used for the course. \n The hints generated could be wrong, and it involves sending data to third party services outside of the university.",buttons:[i.Dialog.createButton({label:"Cancel"}),i.Dialog.createButton({label:"Confirm activation"})],hasClose:!1})).button.label&&(await(async(e,t,n)=>{var o,a,i,r;const s=t.get("hintQuantity").composite,l=null===(o=e.content.model)||void 0===o?void 0:o.cells;if(l&&e.model.getMetadata("etc_identifier")&&"7ca0093b-b622-4463-8696-65f1e0f33522"===e.model.getMetadata("etc_identifier"))for(let o=0;o<l.length;o++)if(l.get(o).getMetadata("nbgrader")&&"markdown"===(null===(a=l.get(o).getMetadata("nbgrader"))||void 0===a?void 0:a.cell_type)&&(null===(i=l.get(o).getMetadata("nbgrader"))||void 0===i?void 0:i.grade_id)&&"cell-018440eg2f1b6a62"!==(null===(r=l.get(o).getMetadata("nbgrader"))||void 0===r?void 0:r.grade_id)){const a=document.createElement("button");a.classList.add("hint-button"),a.id=l.get(o).getMetadata("nbgrader").grade_id,a.onclick=()=>g(e,t,n,l.get(o)),e.content.widgets[o].node.appendChild(a),void 0===l.get(o).getMetadata("remaining_hints")?(l.get(o).setMetadata("remaining_hints",s),a.innerText=`Hint (${s} left for this question)`):a.innerText=`Hint (${l.get(o).getMetadata("remaining_hints")} left for this question)`}})(t,l,o),a.remove(),o.exporters.forEach((e=>o.publishEvent(t,{eventName:"HintBotActivated",eventTime:new Date},e,!1))))}}))}},p=v}}]);